(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? factory(require('@angular/core'),require('@angular/platform-browser'),require('@angular/common'),exports, require('@angular/core'), require('@angular/platform-browser'), require('rxjs'), require('rxjs/operators'), require('@angular/animations'), require('@angular/common')) :
	typeof define === 'function' && define.amd ? define(['@angular/core','@angular/platform-browser','@angular/common','exports', '@angular/core', '@angular/platform-browser', 'rxjs', 'rxjs/operators', '@angular/animations', '@angular/common'], factory) :
	(factory(global.ng.core,global.ng.platformBrowser,global.ng.common,(global.angular2toaster = {}),global.ng.core,global.platformBrowser,global.rxjs,global.operators,global.animations,global.ng.common));
}(this, (function (ɵngcc0,ɵngcc1,ɵngcc2,exports,core,platformBrowser,rxjs,operators,animations,common) { 
var _c0 = ["componentBody"];
var _c1 = ["toastComp", ""];
function ToastComponent_div_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", null, 7);
} }
function ToastComponent_div_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 8);
} if (rf & 2) {
    var ctx_r24 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("innerHTML", ctx_r24.safeBodyHtml, ɵngcc0.ɵɵsanitizeHtml);
} }
function ToastComponent_div_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r25 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ctx_r25.toast.body);
} }
function ToastComponent_div_8_Template(rf, ctx) { if (rf & 1) {
    var _r29 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 9);
    ɵngcc0.ɵɵlistener("click", function ToastComponent_div_8_Template_div_click_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r29); var ctx_r28 = ɵngcc0.ɵɵnextContext(); return ctx_r28.click($event, ctx_r28.toast); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r26 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("innerHTML", ctx_r26.safeCloseHtml, ɵngcc0.ɵɵsanitizeHtml);
} }
function ToasterContainerComponent_div_1_Template(rf, ctx) { if (rf & 1) {
    var _r33 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 2);
    ɵngcc0.ɵɵlistener("click", function ToasterContainerComponent_div_1_Template_div_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r33); var toast_r31 = ctx.$implicit; var ctx_r32 = ɵngcc0.ɵɵnextContext(); return ctx_r32.click(toast_r31); })("clickEvent", function ToasterContainerComponent_div_1_Template_div_clickEvent_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r33); var ctx_r34 = ɵngcc0.ɵɵnextContext(); return ctx_r34.childClick($event); })("mouseover", function ToasterContainerComponent_div_1_Template_div_mouseover_0_listener() { ɵngcc0.ɵɵrestoreView(_r33); var toast_r31 = ctx.$implicit; var ctx_r35 = ɵngcc0.ɵɵnextContext(); return ctx_r35.stopTimer(toast_r31); })("mouseout", function ToasterContainerComponent_div_1_Template_div_mouseout_0_listener() { ɵngcc0.ɵɵrestoreView(_r33); var toast_r31 = ctx.$implicit; var ctx_r36 = ɵngcc0.ɵɵnextContext(); return ctx_r36.restartTimer(toast_r31); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var toast_r31 = ctx.$implicit;
    var ctx_r30 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("toast", toast_r31)("@toastState", ctx_r30.toasterconfig.animation)("iconClass", ctx_r30.toasterconfig.iconClasses[toast_r31.type])("titleClass", ctx_r30.toasterconfig.titleClass)("messageClass", ctx_r30.toasterconfig.messageClass)("ngClass", ctx_r30.toasterconfig.typeClasses[toast_r31.type]);
} }
var _c2 = function (a0) { return [a0]; };
'use strict';

(function (BodyOutputType) {
    BodyOutputType[BodyOutputType["Default"] = 0] = "Default";
    BodyOutputType[BodyOutputType["TrustedHtml"] = 1] = "TrustedHtml";
    BodyOutputType[BodyOutputType["Component"] = 2] = "Component";
})(exports.BodyOutputType || (exports.BodyOutputType = {}));

var __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ToastComponent = /** @class */ (function () {
    function ToastComponent(sanitizer, componentFactoryResolver, changeDetectorRef) {
        this.sanitizer = sanitizer;
        this.componentFactoryResolver = componentFactoryResolver;
        this.changeDetectorRef = changeDetectorRef;
        this.bodyOutputType = exports.BodyOutputType;
        this.clickEvent = new core.EventEmitter();
    }
    ToastComponent.prototype.ngOnInit = function () {
        if (this.toast.closeHtml) {
            this.safeCloseHtml = this.sanitizer.bypassSecurityTrustHtml(this.toast.closeHtml);
        }
        if (this.toast.bodyOutputType === exports.BodyOutputType.TrustedHtml) {
            this.safeBodyHtml = this.sanitizer.bypassSecurityTrustHtml(this.toast.body);
        }
    };
    ToastComponent.prototype.ngAfterViewInit = function () {
        if (this.toast.bodyOutputType === this.bodyOutputType.Component) {
            var component = this.componentFactoryResolver.resolveComponentFactory(this.toast.body);
            var componentInstance = this.componentBody.createComponent(component, undefined, this.componentBody.injector);
            componentInstance.instance.toast = this.toast;
            this.changeDetectorRef.detectChanges();
        }
    };
    ToastComponent.prototype.click = function (event, toast) {
        event.stopPropagation();
        this.clickEvent.emit({
            value: { toast: toast, isCloseButton: true }
        });
    };
    __decorate([
        core.Input(),
        __metadata("design:type", Object)
    ], ToastComponent.prototype, "toast", void 0);
    __decorate([
        core.Input(),
        __metadata("design:type", String)
    ], ToastComponent.prototype, "iconClass", void 0);
    __decorate([
        core.Input(),
        __metadata("design:type", String)
    ], ToastComponent.prototype, "titleClass", void 0);
    __decorate([
        core.Input(),
        __metadata("design:type", String)
    ], ToastComponent.prototype, "messageClass", void 0);
    __decorate([
        core.ViewChild('componentBody', { read: core.ViewContainerRef, static: false }),
        __metadata("design:type", core.ViewContainerRef)
    ], ToastComponent.prototype, "componentBody", void 0);
    __decorate([
        core.Output(),
        __metadata("design:type", Object)
    ], ToastComponent.prototype, "clickEvent", void 0);
    ToastComponent = __decorate([ __metadata("design:paramtypes", [platformBrowser.DomSanitizer,
            core.ComponentFactoryResolver,
            core.ChangeDetectorRef])
    ], ToastComponent);
ToastComponent.ɵfac = function ToastComponent_Factory(t) { return new (t || ToastComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.DomSanitizer), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef)); };
ToastComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ToastComponent, selectors: [["", "toastComp", ""]], viewQuery: function ToastComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, true, core.ViewContainerRef);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.componentBody = _t.first);
    } }, inputs: { toast: "toast", iconClass: "iconClass", titleClass: "titleClass", messageClass: "messageClass" }, outputs: { clickEvent: "clickEvent" }, attrs: _c1, decls: 9, vars: 9, consts: [[1, "toaster-icon", 3, "ngClass"], [1, "toast-content"], [3, "ngClass"], [3, "ngClass", "ngSwitch"], [4, "ngSwitchCase"], [3, "innerHTML", 4, "ngSwitchCase"], ["class", "toast-close-button", 3, "innerHTML", "click", 4, "ngIf"], ["componentBody", ""], [3, "innerHTML"], [1, "toast-close-button", 3, "innerHTML", "click"]], template: function ToastComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelement(0, "i", 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵelementStart(2, "div", 2);
        ɵngcc0.ɵɵtext(3);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(4, "div", 3);
        ɵngcc0.ɵɵtemplate(5, ToastComponent_div_5_Template, 2, 0, "div", 4);
        ɵngcc0.ɵɵtemplate(6, ToastComponent_div_6_Template, 1, 1, "div", 5);
        ɵngcc0.ɵɵtemplate(7, ToastComponent_div_7_Template, 2, 1, "div", 4);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(8, ToastComponent_div_8_Template, 1, 1, "div", 6);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngClass", ctx.iconClass);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngClass", ctx.titleClass);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate(ctx.toast.title);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngClass", ctx.messageClass)("ngSwitch", ctx.toast.bodyOutputType);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngSwitchCase", ctx.bodyOutputType.Component);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngSwitchCase", ctx.bodyOutputType.TrustedHtml);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngSwitchCase", ctx.bodyOutputType.Default);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.toast.showCloseButton);
    } }, directives: [ɵngcc2.NgClass, ɵngcc2.NgSwitch, ɵngcc2.NgSwitchCase, ɵngcc2.NgIf], encapsulation: 2 });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ToastComponent, [{
        type: core.Component,
        args: [{
                selector: '[toastComp]',
                template: "\n        <i class=\"toaster-icon\" [ngClass]=\"iconClass\"></i>\n        <div class=\"toast-content\">\n            <div [ngClass]=\"titleClass\">{{toast.title}}</div>\n            <div [ngClass]=\"messageClass\" [ngSwitch]=\"toast.bodyOutputType\">\n                <div *ngSwitchCase=\"bodyOutputType.Component\" #componentBody></div>\n                <div *ngSwitchCase=\"bodyOutputType.TrustedHtml\" [innerHTML]=\"safeBodyHtml\"></div>\n                <div *ngSwitchCase=\"bodyOutputType.Default\">{{toast.body}}</div>\n            </div>\n        </div>\n        <div class=\"toast-close-button\" *ngIf=\"toast.showCloseButton\" (click)=\"click($event, toast)\"\n            [innerHTML]=\"safeCloseHtml\">\n        </div>"
            }]
    }], function () { return [{ type: ɵngcc1.DomSanitizer }, { type: ɵngcc0.ComponentFactoryResolver }, { type: ɵngcc0.ChangeDetectorRef }]; }, { clickEvent: [{
            type: core.Output
        }], toast: [{
            type: core.Input
        }], iconClass: [{
            type: core.Input
        }], titleClass: [{
            type: core.Input
        }], messageClass: [{
            type: core.Input
        }], componentBody: [{
            type: core.ViewChild,
            args: ['componentBody', { read: core.ViewContainerRef, static: false }]
        }] }); })();
    return ToastComponent;
}());

var ToasterConfig = /** @class */ (function () {
    function ToasterConfig(configOverrides) {
        configOverrides = configOverrides || {};
        this.limit = configOverrides.limit || null;
        this.tapToDismiss = configOverrides.tapToDismiss != null ? configOverrides.tapToDismiss : true;
        this.showCloseButton = configOverrides.showCloseButton != null ? configOverrides.showCloseButton : false;
        this.closeHtml = configOverrides.closeHtml || '<button class="toast-close-button" type="button">&times;</button>';
        this.newestOnTop = configOverrides.newestOnTop != null ? configOverrides.newestOnTop : true;
        this.timeout = configOverrides.timeout != null ? configOverrides.timeout : 5000;
        this.typeClasses = configOverrides.typeClasses || {
            error: 'toast-error',
            info: 'toast-info',
            wait: 'toast-wait',
            success: 'toast-success',
            warning: 'toast-warning'
        };
        this.iconClasses = configOverrides.iconClasses || {
            error: 'icon-error',
            info: 'icon-info',
            wait: 'icon-wait',
            success: 'icon-success',
            warning: 'icon-warning'
        };
        this.bodyOutputType = configOverrides.bodyOutputType || exports.BodyOutputType.Default;
        this.bodyTemplate = configOverrides.bodyTemplate || 'toasterBodyTmpl.html';
        this.defaultTypeClass = configOverrides.defaultTypeClass || 'toast-info';
        this.positionClass = configOverrides.positionClass || 'toast-top-right';
        this.titleClass = configOverrides.titleClass || 'toast-title';
        this.messageClass = configOverrides.messageClass || 'toast-message';
        this.animation = configOverrides.animation || '';
        this.preventDuplicates = configOverrides.preventDuplicates != null ? configOverrides.preventDuplicates : false;
        this.mouseoverTimerStop = configOverrides.mouseoverTimerStop != null ? configOverrides.mouseoverTimerStop : false;
        this.toastContainerId = configOverrides.toastContainerId != null ? configOverrides.toastContainerId : null;
    }
    return ToasterConfig;
}());

var __decorate$1 = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata$1 = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
// http://stackoverflow.com/questions/26501688/a-typescript-guid-class
var Guid = /** @class */ (function () {
    function Guid() {
    }
    Guid.newGuid = function () {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
    };
    return Guid;
}());
var ToasterService = /** @class */ (function () {
    /**
     * Creates an instance of ToasterService.
     */
    function ToasterService() {
        var _this = this;
        this.addToast = new rxjs.Observable(function (observer) { return _this._addToast = observer; }).pipe(operators.share());
        this.clearToasts = new rxjs.Observable(function (observer) { return _this._clearToasts = observer; }).pipe(operators.share());
        this._removeToastSubject = new rxjs.Subject();
        this.removeToast = this._removeToastSubject.pipe(operators.share());
    }
    /**
     * Synchronously create and show a new toast instance.
     *
     * @param {(string | Toast)} type The type of the toast, or a Toast object.
     * @param {string=} title The toast title.
     * @param {string=} body The toast body.
     * @returns {Toast}
     *          The newly created Toast instance with a randomly generated GUID Id.
     */
    ToasterService.prototype.pop = function (type, title, body) {
        var toast = typeof type === 'string' ? { type: type, title: title, body: body } : type;
        if (!toast.toastId) {
            toast.toastId = Guid.newGuid();
        }
        if (!this._addToast) {
            throw new Error('No Toaster Containers have been initialized to receive toasts.');
        }
        this._addToast.next(toast);
        return toast;
    };
    /**
     * Asynchronously create and show a new toast instance.
     *
     * @param {(string | Toast)} type The type of the toast, or a Toast object.
     * @param {string=} title The toast title.
     * @param {string=} body The toast body.
     * @returns {Observable<Toast>}
     *          A hot Observable that can be subscribed to in order to receive the Toast instance
     *          with a randomly generated GUID Id.
     */
    ToasterService.prototype.popAsync = function (type, title, body) {
        var _this = this;
        setTimeout(function () {
            _this.pop(type, title, body);
        }, 0);
        return this.addToast;
    };
    /**
     * Clears a toast by toastId and/or toastContainerId.
     *
     * @param {string} toastId The toastId to clear.
     * @param {number=} toastContainerId
     *        The toastContainerId of the container to remove toasts from.
     */
    ToasterService.prototype.clear = function (toastId, toastContainerId) {
        var clearWrapper = {
            toastId: toastId, toastContainerId: toastContainerId
        };
        this._clearToasts.next(clearWrapper);
    };
    ToasterService = __decorate$1([ __metadata$1("design:paramtypes", [])
    ], ToasterService);
ToasterService.ɵfac = function ToasterService_Factory(t) { return new (t || ToasterService)(); };
ToasterService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: ToasterService, factory: function (t) { return ToasterService.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ToasterService, [{
        type: core.Injectable
    }], function () { return []; }, null); })();
    return ToasterService;
}());

var __decorate$2 = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata$2 = (undefined && undefined.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var ToasterContainerComponent = /** @class */ (function () {
    function ToasterContainerComponent(toasterService, ref, ngZone) {
        this.ref = ref;
        this.ngZone = ngZone;
        this.timeoutIds = new Map();
        this.toasts = [];
        this.toasterService = toasterService;
    }
    ToasterContainerComponent.prototype.ngOnInit = function () {
        this.registerSubscribers();
        if (this.isNullOrUndefined(this.toasterconfig)) {
            this.toasterconfig = new ToasterConfig();
        }
    };
    // event handlers
    ToasterContainerComponent.prototype.click = function (toast, isCloseButton) {
        if (this.toasterconfig.tapToDismiss || (toast.showCloseButton && isCloseButton)) {
            var removeToast = true;
            if (toast.clickHandler) {
                if (typeof toast.clickHandler === 'function') {
                    removeToast = toast.clickHandler(toast, isCloseButton);
                }
                else {
                    console.log('The toast click handler is not a callable function.');
                    return false;
                }
            }
            if (removeToast) {
                this.removeToast(toast);
            }
        }
    };
    ToasterContainerComponent.prototype.childClick = function ($event) {
        this.click($event.value.toast, $event.value.isCloseButton);
    };
    ToasterContainerComponent.prototype.stopTimer = function (toast) {
        if (this.toasterconfig.mouseoverTimerStop) {
            var toastId = this.toastIdOrDefault(toast);
            var timeoutId = this.timeoutIds.get(toastId);
            if (timeoutId) {
                window.clearTimeout(timeoutId);
                this.timeoutIds.delete(toastId);
            }
        }
    };
    ToasterContainerComponent.prototype.restartTimer = function (toast) {
        var timeoutId = this.timeoutIds.get(this.toastIdOrDefault(toast));
        if (this.toasterconfig.mouseoverTimerStop) {
            if (!timeoutId) {
                this.configureTimer(toast);
            }
        }
        else if (toast.timeout !== 0 && !timeoutId && this.toasterconfig.timeout) {
            this.removeToast(toast);
        }
    };
    // private functions
    ToasterContainerComponent.prototype.registerSubscribers = function () {
        var _this = this;
        this.addToastSubscriber = this.toasterService.addToast.subscribe(function (toast) {
            _this.addToast(toast);
        });
        this.clearToastsSubscriber = this.toasterService.clearToasts.subscribe(function (clearWrapper) {
            _this.clearToasts(clearWrapper);
        });
    };
    ToasterContainerComponent.prototype.addToast = function (toast) {
        if (toast.toastContainerId && this.toasterconfig.toastContainerId
            && toast.toastContainerId !== this.toasterconfig.toastContainerId) {
            return;
        }
        
        if (!toast.type) {
            toast.type = this.toasterconfig.defaultTypeClass;
        }
        if (this.toasterconfig.preventDuplicates && this.toasts.length > 0) {
            if (toast.toastId && this.toasts.some(function (t) { return t.toastId === toast.toastId; })) {
                return;
            }
            else if (this.toasts.some(function (t) { return t.body === toast.body; })) {
                return;
            }
        }
        if (this.isNullOrUndefined(toast.showCloseButton)) {
            if (typeof this.toasterconfig.showCloseButton === 'object') {
                toast.showCloseButton = this.toasterconfig.showCloseButton[toast.type];
            }
            else if (typeof this.toasterconfig.showCloseButton === 'boolean') {
                toast.showCloseButton = this.toasterconfig.showCloseButton;
            }
        }
        if (toast.showCloseButton) {
            toast.closeHtml = toast.closeHtml || this.toasterconfig.closeHtml;
        }
        toast.bodyOutputType = toast.bodyOutputType || this.toasterconfig.bodyOutputType;
        this.configureTimer(toast);
        if (this.toasterconfig.newestOnTop) {
            this.toasts.unshift(toast);
            if (this.isLimitExceeded()) {
                this.toasts.pop();
            }
        }
        else {
            this.toasts.push(toast);
            if (this.isLimitExceeded()) {
                this.toasts.shift();
            }
        }
        if (toast.onShowCallback) {
            toast.onShowCallback(toast);
        }
    };
    ToasterContainerComponent.prototype.configureTimer = function (toast) {
        var _this = this;
        var timeout = (typeof toast.timeout === 'number')
            ? toast.timeout : this.toasterconfig.timeout;
        if (typeof timeout === 'object') {
            timeout = timeout[toast.type];
        }
        
        if (timeout > 0) {
            this.ngZone.runOutsideAngular(function () {
                var timeoutId = window.setTimeout(function () {
                    _this.ngZone.run(function () {
                        _this.ref.markForCheck();
                        _this.removeToast(toast);
                    });
                }, timeout);
                _this.timeoutIds.set(_this.toastIdOrDefault(toast), timeoutId);
            });
        }
    };
    ToasterContainerComponent.prototype.isLimitExceeded = function () {
        return this.toasterconfig.limit && this.toasts.length > this.toasterconfig.limit;
    };
    ToasterContainerComponent.prototype.removeToast = function (toast) {
        var index = this.toasts.indexOf(toast);
        if (index < 0) {
            return;
        }
        
        var toastId = this.toastIdOrDefault(toast);
        var timeoutId = this.timeoutIds.get(toastId);
        this.toasts.splice(index, 1);
        if (timeoutId) {
            window.clearTimeout(timeoutId);
            this.timeoutIds.delete(toastId);
        }
        if (toast.onHideCallback) {
            toast.onHideCallback(toast);
        }
        this.toasterService._removeToastSubject.next({ toastId: toastId, toastContainerId: toast.toastContainerId });
    };
    ToasterContainerComponent.prototype.removeAllToasts = function () {
        for (var i = this.toasts.length - 1; i >= 0; i--) {
            this.removeToast(this.toasts[i]);
        }
    };
    ToasterContainerComponent.prototype.clearToasts = function (clearWrapper) {
        var toastId = clearWrapper.toastId;
        var toastContainerId = clearWrapper.toastContainerId;
        if (this.isNullOrUndefined(toastContainerId)) {
            this.clearToastsAction(toastId);
        }
        else if (toastContainerId === this.toasterconfig.toastContainerId) {
            this.clearToastsAction(toastId);
        }
    };
    ToasterContainerComponent.prototype.clearToastsAction = function (toastId) {
        if (toastId) {
            this.removeToast(this.toasts.filter(function (t) { return t.toastId === toastId; })[0]);
        }
        else {
            this.removeAllToasts();
        }
    };
    ToasterContainerComponent.prototype.toastIdOrDefault = function (toast) {
        return toast.toastId || '';
    };
    ToasterContainerComponent.prototype.isNullOrUndefined = function (value) {
        return value === null || typeof value === 'undefined';
    };
    ToasterContainerComponent.prototype.ngOnDestroy = function () {
        if (this.addToastSubscriber) {
            this.addToastSubscriber.unsubscribe();
        }
        if (this.clearToastsSubscriber) {
            this.clearToastsSubscriber.unsubscribe();
        }
    };
    __decorate$2([
        core.Input(),
        __metadata$2("design:type", ToasterConfig)
    ], ToasterContainerComponent.prototype, "toasterconfig", void 0);
    ToasterContainerComponent = __decorate$2([ __metadata$2("design:paramtypes", [ToasterService, core.ChangeDetectorRef, core.NgZone])
    ], ToasterContainerComponent);
ToasterContainerComponent.ɵfac = function ToasterContainerComponent_Factory(t) { return new (t || ToasterContainerComponent)(ɵngcc0.ɵɵdirectiveInject(ToasterService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
ToasterContainerComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ToasterContainerComponent, selectors: [["toaster-container"]], inputs: { toasterconfig: "toasterconfig" }, decls: 2, vars: 4, consts: [["id", "toast-container", 3, "ngClass"], ["toastComp", "", "class", "toast", 3, "toast", "iconClass", "titleClass", "messageClass", "ngClass", "click", "clickEvent", "mouseover", "mouseout", 4, "ngFor", "ngForOf"], ["toastComp", "", 1, "toast", 3, "toast", "iconClass", "titleClass", "messageClass", "ngClass", "click", "clickEvent", "mouseover", "mouseout"]], template: function ToasterContainerComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵtemplate(1, ToasterContainerComponent_div_1_Template, 1, 6, "div", 1);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(2, _c2, ctx.toasterconfig.positionClass));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.toasts);
    } }, directives: [ɵngcc2.NgClass, ɵngcc2.NgForOf, ToastComponent], encapsulation: 2, data: { animation: [
            animations.trigger('toastState', [
                animations.state('flyRight, flyLeft, slideDown, slideUp, fade', animations.style({ opacity: 1, transform: 'translate(0,0)' })),
                animations.transition('void => flyRight', [
                    animations.style({
                        opacity: 0, transform: 'translateX(100%)'
                    }),
                    animations.animate('0.25s ease-in')
                ]),
                animations.transition('flyRight => void', [
                    animations.animate('0.25s 10ms ease-out', animations.style({
                        opacity: 0, transform: 'translateX(100%)'
                    }))
                ]),
                animations.transition('void => flyLeft', [
                    animations.style({
                        opacity: 0, transform: 'translateX(-100%)'
                    }),
                    animations.animate('0.25s ease-in')
                ]),
                animations.transition('flyLeft => void', [
                    animations.animate('0.25s 10ms ease-out', animations.style({
                        opacity: 0, transform: 'translateX(-100%)'
                    }))
                ]),
                animations.transition('void => slideDown', [
                    animations.style({
                        opacity: 0, transform: 'translateY(-200%)'
                    }),
                    animations.animate('0.3s ease-in')
                ]),
                animations.transition('slideDown => void', [
                    animations.animate('0.3s 10ms ease-out', animations.style({
                        opacity: 0, transform: 'translateY(200%)'
                    }))
                ]),
                animations.transition('void => slideUp', [
                    animations.style({
                        opacity: 0, transform: 'translateY(200%)'
                    }),
                    animations.animate('0.3s ease-in')
                ]),
                animations.transition('slideUp => void', [
                    animations.animate('0.3s 10ms ease-out', animations.style({
                        opacity: 0, transform: 'translateY(-200%)'
                    }))
                ]),
                animations.transition('void => fade', [
                    animations.style({
                        opacity: 0
                    }),
                    animations.animate('0.3s ease-in')
                ]),
                animations.transition('fade => void', [
                    animations.animate('0.3s 10ms ease-out', animations.style({
                        opacity: 0
                    }))
                ])
            ]),
        ] } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ToasterContainerComponent, [{
        type: core.Component,
        args: [{
                selector: 'toaster-container',
                template: "\n        <div id=\"toast-container\" [ngClass]=\"[toasterconfig.positionClass]\">\n            <div toastComp *ngFor=\"let toast of toasts\" class=\"toast\" [toast]=\"toast\"\n                [@toastState]=\"toasterconfig.animation\"\n                [iconClass]=\"toasterconfig.iconClasses[toast.type]\"\n                [titleClass]=\"toasterconfig.titleClass\"\n                [messageClass]=\"toasterconfig.messageClass\"\n                [ngClass]=\"toasterconfig.typeClasses[toast.type]\"\n                (click)=\"click(toast)\" (clickEvent)=\"childClick($event)\"\n                (mouseover)=\"stopTimer(toast)\" (mouseout)=\"restartTimer(toast)\">\n            </div>\n        </div>\n        ",
                animations: [
                    animations.trigger('toastState', [
                        animations.state('flyRight, flyLeft, slideDown, slideUp, fade', animations.style({ opacity: 1, transform: 'translate(0,0)' })),
                        animations.transition('void => flyRight', [
                            animations.style({
                                opacity: 0, transform: 'translateX(100%)'
                            }),
                            animations.animate('0.25s ease-in')
                        ]),
                        animations.transition('flyRight => void', [
                            animations.animate('0.25s 10ms ease-out', animations.style({
                                opacity: 0, transform: 'translateX(100%)'
                            }))
                        ]),
                        animations.transition('void => flyLeft', [
                            animations.style({
                                opacity: 0, transform: 'translateX(-100%)'
                            }),
                            animations.animate('0.25s ease-in')
                        ]),
                        animations.transition('flyLeft => void', [
                            animations.animate('0.25s 10ms ease-out', animations.style({
                                opacity: 0, transform: 'translateX(-100%)'
                            }))
                        ]),
                        animations.transition('void => slideDown', [
                            animations.style({
                                opacity: 0, transform: 'translateY(-200%)'
                            }),
                            animations.animate('0.3s ease-in')
                        ]),
                        animations.transition('slideDown => void', [
                            animations.animate('0.3s 10ms ease-out', animations.style({
                                opacity: 0, transform: 'translateY(200%)'
                            }))
                        ]),
                        animations.transition('void => slideUp', [
                            animations.style({
                                opacity: 0, transform: 'translateY(200%)'
                            }),
                            animations.animate('0.3s ease-in')
                        ]),
                        animations.transition('slideUp => void', [
                            animations.animate('0.3s 10ms ease-out', animations.style({
                                opacity: 0, transform: 'translateY(-200%)'
                            }))
                        ]),
                        animations.transition('void => fade', [
                            animations.style({
                                opacity: 0
                            }),
                            animations.animate('0.3s ease-in')
                        ]),
                        animations.transition('fade => void', [
                            animations.animate('0.3s 10ms ease-out', animations.style({
                                opacity: 0
                            }))
                        ])
                    ]),
                ]
            }]
    }], function () { return [{ type: ToasterService }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc0.NgZone }]; }, { toasterconfig: [{
            type: core.Input
        }] }); })();
    return ToasterContainerComponent;
}());

var __decorate$3 = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var ToasterModule = /** @class */ (function () {
    function ToasterModule() {
    }
    ToasterModule_1 = ToasterModule;
    ToasterModule.forRoot = function () {
        return {
            ngModule: ToasterModule_1,
            providers: [ToasterService, ToasterContainerComponent]
        };
    };
    ToasterModule.forChild = function () {
        return {
            ngModule: ToasterModule_1,
            providers: [ToasterContainerComponent]
        };
    };
    var ToasterModule_1;
ToasterModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: ToasterModule });
ToasterModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function ToasterModule_Factory(t) { return new (t || ToasterModule)(); }, imports: [[common.CommonModule]] });
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(ToasterModule, { declarations: [ToastComponent,
        ToasterContainerComponent], imports: [ɵngcc2.CommonModule], exports: [ToasterContainerComponent,
        ToastComponent] }); })();
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ToasterModule, [{
        type: core.NgModule,
        args: [{
                imports: [common.CommonModule],
                declarations: [
                    ToastComponent,
                    ToasterContainerComponent
                ],
                exports: [
                    ToasterContainerComponent,
                    ToastComponent
                ]
            }]
    }], function () { return []; }, null); })();
    return ToasterModule;
}());

exports.ToastComponent = ToastComponent;
exports.ToasterContainerComponent = ToasterContainerComponent;
exports.ToasterService = ToasterService;
exports.ToasterConfig = ToasterConfig;
exports.ToasterModule = ToasterModule;

Object.defineProperty(exports, '__esModule', { value: true });

})));

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhcjItdG9hc3Rlci51bWQuanMiLCJzb3VyY2VzIjpbImFuZ3VsYXIyLXRvYXN0ZXIudW1kLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO2lLQUN3RTtvSEFDbEI7b0VBQzVDO3dDQUNTOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFpRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7aUNBdUVuRCxBQUsxQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBR2dCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7bUNBMkhZLEFBRTVCOzs7Ozs7Z0RBQ2dCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OENBK011QixBQWlFdkM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQzJCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozt3QkEwQlY7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Z0RBYUYiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkge1xuXHR0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBmYWN0b3J5KGV4cG9ydHMsIHJlcXVpcmUoJ0Bhbmd1bGFyL2NvcmUnKSwgcmVxdWlyZSgnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3NlcicpLCByZXF1aXJlKCdyeGpzJyksIHJlcXVpcmUoJ3J4anMvb3BlcmF0b3JzJyksIHJlcXVpcmUoJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnKSwgcmVxdWlyZSgnQGFuZ3VsYXIvY29tbW9uJykpIDpcblx0dHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKFsnZXhwb3J0cycsICdAYW5ndWxhci9jb3JlJywgJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInLCAncnhqcycsICdyeGpzL29wZXJhdG9ycycsICdAYW5ndWxhci9hbmltYXRpb25zJywgJ0Bhbmd1bGFyL2NvbW1vbiddLCBmYWN0b3J5KSA6XG5cdChmYWN0b3J5KChnbG9iYWwuYW5ndWxhcjJ0b2FzdGVyID0ge30pLGdsb2JhbC5uZy5jb3JlLGdsb2JhbC5wbGF0Zm9ybUJyb3dzZXIsZ2xvYmFsLnJ4anMsZ2xvYmFsLm9wZXJhdG9ycyxnbG9iYWwuYW5pbWF0aW9ucyxnbG9iYWwubmcuY29tbW9uKSk7XG59KHRoaXMsIChmdW5jdGlvbiAoZXhwb3J0cyxjb3JlLHBsYXRmb3JtQnJvd3NlcixyeGpzLG9wZXJhdG9ycyxhbmltYXRpb25zLGNvbW1vbikgeyAndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoQm9keU91dHB1dFR5cGUpIHtcbiAgICBCb2R5T3V0cHV0VHlwZVtCb2R5T3V0cHV0VHlwZVtcIkRlZmF1bHRcIl0gPSAwXSA9IFwiRGVmYXVsdFwiO1xuICAgIEJvZHlPdXRwdXRUeXBlW0JvZHlPdXRwdXRUeXBlW1wiVHJ1c3RlZEh0bWxcIl0gPSAxXSA9IFwiVHJ1c3RlZEh0bWxcIjtcbiAgICBCb2R5T3V0cHV0VHlwZVtCb2R5T3V0cHV0VHlwZVtcIkNvbXBvbmVudFwiXSA9IDJdID0gXCJDb21wb25lbnRcIjtcbn0pKGV4cG9ydHMuQm9keU91dHB1dFR5cGUgfHwgKGV4cG9ydHMuQm9keU91dHB1dFR5cGUgPSB7fSkpO1xuXG52YXIgX19kZWNvcmF0ZSA9ICh1bmRlZmluZWQgJiYgdW5kZWZpbmVkLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xudmFyIF9fbWV0YWRhdGEgPSAodW5kZWZpbmVkICYmIHVuZGVmaW5lZC5fX21ldGFkYXRhKSB8fCBmdW5jdGlvbiAoaywgdikge1xuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShrLCB2KTtcbn07XG52YXIgVG9hc3RDb21wb25lbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVG9hc3RDb21wb25lbnQoc2FuaXRpemVyLCBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIGNoYW5nZURldGVjdG9yUmVmKSB7XG4gICAgICAgIHRoaXMuc2FuaXRpemVyID0gc2FuaXRpemVyO1xuICAgICAgICB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlciA9IGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjtcbiAgICAgICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZiA9IGNoYW5nZURldGVjdG9yUmVmO1xuICAgICAgICB0aGlzLmJvZHlPdXRwdXRUeXBlID0gZXhwb3J0cy5Cb2R5T3V0cHV0VHlwZTtcbiAgICAgICAgdGhpcy5jbGlja0V2ZW50ID0gbmV3IGNvcmUuRXZlbnRFbWl0dGVyKCk7XG4gICAgfVxuICAgIFRvYXN0Q29tcG9uZW50LnByb3RvdHlwZS5uZ09uSW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMudG9hc3QuY2xvc2VIdG1sKSB7XG4gICAgICAgICAgICB0aGlzLnNhZmVDbG9zZUh0bWwgPSB0aGlzLnNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0SHRtbCh0aGlzLnRvYXN0LmNsb3NlSHRtbCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudG9hc3QuYm9keU91dHB1dFR5cGUgPT09IGV4cG9ydHMuQm9keU91dHB1dFR5cGUuVHJ1c3RlZEh0bWwpIHtcbiAgICAgICAgICAgIHRoaXMuc2FmZUJvZHlIdG1sID0gdGhpcy5zYW5pdGl6ZXIuYnlwYXNzU2VjdXJpdHlUcnVzdEh0bWwodGhpcy50b2FzdC5ib2R5KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVG9hc3RDb21wb25lbnQucHJvdG90eXBlLm5nQWZ0ZXJWaWV3SW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMudG9hc3QuYm9keU91dHB1dFR5cGUgPT09IHRoaXMuYm9keU91dHB1dFR5cGUuQ29tcG9uZW50KSB7XG4gICAgICAgICAgICB2YXIgY29tcG9uZW50ID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkodGhpcy50b2FzdC5ib2R5KTtcbiAgICAgICAgICAgIHZhciBjb21wb25lbnRJbnN0YW5jZSA9IHRoaXMuY29tcG9uZW50Qm9keS5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50LCB1bmRlZmluZWQsIHRoaXMuY29tcG9uZW50Qm9keS5pbmplY3Rvcik7XG4gICAgICAgICAgICBjb21wb25lbnRJbnN0YW5jZS5pbnN0YW5jZS50b2FzdCA9IHRoaXMudG9hc3Q7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVG9hc3RDb21wb25lbnQucHJvdG90eXBlLmNsaWNrID0gZnVuY3Rpb24gKGV2ZW50LCB0b2FzdCkge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5jbGlja0V2ZW50LmVtaXQoe1xuICAgICAgICAgICAgdmFsdWU6IHsgdG9hc3Q6IHRvYXN0LCBpc0Nsb3NlQnV0dG9uOiB0cnVlIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBfX2RlY29yYXRlKFtcbiAgICAgICAgY29yZS5JbnB1dCgpLFxuICAgICAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgT2JqZWN0KVxuICAgIF0sIFRvYXN0Q29tcG9uZW50LnByb3RvdHlwZSwgXCJ0b2FzdFwiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW1xuICAgICAgICBjb3JlLklucHV0KCksXG4gICAgICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG4gICAgXSwgVG9hc3RDb21wb25lbnQucHJvdG90eXBlLCBcImljb25DbGFzc1wiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW1xuICAgICAgICBjb3JlLklucHV0KCksXG4gICAgICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG4gICAgXSwgVG9hc3RDb21wb25lbnQucHJvdG90eXBlLCBcInRpdGxlQ2xhc3NcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtcbiAgICAgICAgY29yZS5JbnB1dCgpLFxuICAgICAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuICAgIF0sIFRvYXN0Q29tcG9uZW50LnByb3RvdHlwZSwgXCJtZXNzYWdlQ2xhc3NcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtcbiAgICAgICAgY29yZS5WaWV3Q2hpbGQoJ2NvbXBvbmVudEJvZHknLCB7IHJlYWQ6IGNvcmUuVmlld0NvbnRhaW5lclJlZiwgc3RhdGljOiBmYWxzZSB9KSxcbiAgICAgICAgX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIGNvcmUuVmlld0NvbnRhaW5lclJlZilcbiAgICBdLCBUb2FzdENvbXBvbmVudC5wcm90b3R5cGUsIFwiY29tcG9uZW50Qm9keVwiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW1xuICAgICAgICBjb3JlLk91dHB1dCgpLFxuICAgICAgICBfX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgT2JqZWN0KVxuICAgIF0sIFRvYXN0Q29tcG9uZW50LnByb3RvdHlwZSwgXCJjbGlja0V2ZW50XCIsIHZvaWQgMCk7XG4gICAgVG9hc3RDb21wb25lbnQgPSBfX2RlY29yYXRlKFtcbiAgICAgICAgY29yZS5Db21wb25lbnQoe1xuICAgICAgICAgICAgc2VsZWN0b3I6ICdbdG9hc3RDb21wXScsXG4gICAgICAgICAgICB0ZW1wbGF0ZTogXCJcXG4gICAgICAgIDxpIGNsYXNzPVxcXCJ0b2FzdGVyLWljb25cXFwiIFtuZ0NsYXNzXT1cXFwiaWNvbkNsYXNzXFxcIj48L2k+XFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJ0b2FzdC1jb250ZW50XFxcIj5cXG4gICAgICAgICAgICA8ZGl2IFtuZ0NsYXNzXT1cXFwidGl0bGVDbGFzc1xcXCI+e3t0b2FzdC50aXRsZX19PC9kaXY+XFxuICAgICAgICAgICAgPGRpdiBbbmdDbGFzc109XFxcIm1lc3NhZ2VDbGFzc1xcXCIgW25nU3dpdGNoXT1cXFwidG9hc3QuYm9keU91dHB1dFR5cGVcXFwiPlxcbiAgICAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcImJvZHlPdXRwdXRUeXBlLkNvbXBvbmVudFxcXCIgI2NvbXBvbmVudEJvZHk+PC9kaXY+XFxuICAgICAgICAgICAgICAgIDxkaXYgKm5nU3dpdGNoQ2FzZT1cXFwiYm9keU91dHB1dFR5cGUuVHJ1c3RlZEh0bWxcXFwiIFtpbm5lckhUTUxdPVxcXCJzYWZlQm9keUh0bWxcXFwiPjwvZGl2PlxcbiAgICAgICAgICAgICAgICA8ZGl2ICpuZ1N3aXRjaENhc2U9XFxcImJvZHlPdXRwdXRUeXBlLkRlZmF1bHRcXFwiPnt7dG9hc3QuYm9keX19PC9kaXY+XFxuICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcInRvYXN0LWNsb3NlLWJ1dHRvblxcXCIgKm5nSWY9XFxcInRvYXN0LnNob3dDbG9zZUJ1dHRvblxcXCIgKGNsaWNrKT1cXFwiY2xpY2soJGV2ZW50LCB0b2FzdClcXFwiXFxuICAgICAgICAgICAgW2lubmVySFRNTF09XFxcInNhZmVDbG9zZUh0bWxcXFwiPlxcbiAgICAgICAgPC9kaXY+XCJcbiAgICAgICAgfSksXG4gICAgICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbcGxhdGZvcm1Ccm93c2VyLkRvbVNhbml0aXplcixcbiAgICAgICAgICAgIGNvcmUuQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgICAgICAgICAgY29yZS5DaGFuZ2VEZXRlY3RvclJlZl0pXG4gICAgXSwgVG9hc3RDb21wb25lbnQpO1xuICAgIHJldHVybiBUb2FzdENvbXBvbmVudDtcbn0oKSk7XG5cbnZhciBUb2FzdGVyQ29uZmlnID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFRvYXN0ZXJDb25maWcoY29uZmlnT3ZlcnJpZGVzKSB7XG4gICAgICAgIGNvbmZpZ092ZXJyaWRlcyA9IGNvbmZpZ092ZXJyaWRlcyB8fCB7fTtcbiAgICAgICAgdGhpcy5saW1pdCA9IGNvbmZpZ092ZXJyaWRlcy5saW1pdCB8fCBudWxsO1xuICAgICAgICB0aGlzLnRhcFRvRGlzbWlzcyA9IGNvbmZpZ092ZXJyaWRlcy50YXBUb0Rpc21pc3MgIT0gbnVsbCA/IGNvbmZpZ092ZXJyaWRlcy50YXBUb0Rpc21pc3MgOiB0cnVlO1xuICAgICAgICB0aGlzLnNob3dDbG9zZUJ1dHRvbiA9IGNvbmZpZ092ZXJyaWRlcy5zaG93Q2xvc2VCdXR0b24gIT0gbnVsbCA/IGNvbmZpZ092ZXJyaWRlcy5zaG93Q2xvc2VCdXR0b24gOiBmYWxzZTtcbiAgICAgICAgdGhpcy5jbG9zZUh0bWwgPSBjb25maWdPdmVycmlkZXMuY2xvc2VIdG1sIHx8ICc8YnV0dG9uIGNsYXNzPVwidG9hc3QtY2xvc2UtYnV0dG9uXCIgdHlwZT1cImJ1dHRvblwiPiZ0aW1lczs8L2J1dHRvbj4nO1xuICAgICAgICB0aGlzLm5ld2VzdE9uVG9wID0gY29uZmlnT3ZlcnJpZGVzLm5ld2VzdE9uVG9wICE9IG51bGwgPyBjb25maWdPdmVycmlkZXMubmV3ZXN0T25Ub3AgOiB0cnVlO1xuICAgICAgICB0aGlzLnRpbWVvdXQgPSBjb25maWdPdmVycmlkZXMudGltZW91dCAhPSBudWxsID8gY29uZmlnT3ZlcnJpZGVzLnRpbWVvdXQgOiA1MDAwO1xuICAgICAgICB0aGlzLnR5cGVDbGFzc2VzID0gY29uZmlnT3ZlcnJpZGVzLnR5cGVDbGFzc2VzIHx8IHtcbiAgICAgICAgICAgIGVycm9yOiAndG9hc3QtZXJyb3InLFxuICAgICAgICAgICAgaW5mbzogJ3RvYXN0LWluZm8nLFxuICAgICAgICAgICAgd2FpdDogJ3RvYXN0LXdhaXQnLFxuICAgICAgICAgICAgc3VjY2VzczogJ3RvYXN0LXN1Y2Nlc3MnLFxuICAgICAgICAgICAgd2FybmluZzogJ3RvYXN0LXdhcm5pbmcnXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaWNvbkNsYXNzZXMgPSBjb25maWdPdmVycmlkZXMuaWNvbkNsYXNzZXMgfHwge1xuICAgICAgICAgICAgZXJyb3I6ICdpY29uLWVycm9yJyxcbiAgICAgICAgICAgIGluZm86ICdpY29uLWluZm8nLFxuICAgICAgICAgICAgd2FpdDogJ2ljb24td2FpdCcsXG4gICAgICAgICAgICBzdWNjZXNzOiAnaWNvbi1zdWNjZXNzJyxcbiAgICAgICAgICAgIHdhcm5pbmc6ICdpY29uLXdhcm5pbmcnXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYm9keU91dHB1dFR5cGUgPSBjb25maWdPdmVycmlkZXMuYm9keU91dHB1dFR5cGUgfHwgZXhwb3J0cy5Cb2R5T3V0cHV0VHlwZS5EZWZhdWx0O1xuICAgICAgICB0aGlzLmJvZHlUZW1wbGF0ZSA9IGNvbmZpZ092ZXJyaWRlcy5ib2R5VGVtcGxhdGUgfHwgJ3RvYXN0ZXJCb2R5VG1wbC5odG1sJztcbiAgICAgICAgdGhpcy5kZWZhdWx0VHlwZUNsYXNzID0gY29uZmlnT3ZlcnJpZGVzLmRlZmF1bHRUeXBlQ2xhc3MgfHwgJ3RvYXN0LWluZm8nO1xuICAgICAgICB0aGlzLnBvc2l0aW9uQ2xhc3MgPSBjb25maWdPdmVycmlkZXMucG9zaXRpb25DbGFzcyB8fCAndG9hc3QtdG9wLXJpZ2h0JztcbiAgICAgICAgdGhpcy50aXRsZUNsYXNzID0gY29uZmlnT3ZlcnJpZGVzLnRpdGxlQ2xhc3MgfHwgJ3RvYXN0LXRpdGxlJztcbiAgICAgICAgdGhpcy5tZXNzYWdlQ2xhc3MgPSBjb25maWdPdmVycmlkZXMubWVzc2FnZUNsYXNzIHx8ICd0b2FzdC1tZXNzYWdlJztcbiAgICAgICAgdGhpcy5hbmltYXRpb24gPSBjb25maWdPdmVycmlkZXMuYW5pbWF0aW9uIHx8ICcnO1xuICAgICAgICB0aGlzLnByZXZlbnREdXBsaWNhdGVzID0gY29uZmlnT3ZlcnJpZGVzLnByZXZlbnREdXBsaWNhdGVzICE9IG51bGwgPyBjb25maWdPdmVycmlkZXMucHJldmVudER1cGxpY2F0ZXMgOiBmYWxzZTtcbiAgICAgICAgdGhpcy5tb3VzZW92ZXJUaW1lclN0b3AgPSBjb25maWdPdmVycmlkZXMubW91c2VvdmVyVGltZXJTdG9wICE9IG51bGwgPyBjb25maWdPdmVycmlkZXMubW91c2VvdmVyVGltZXJTdG9wIDogZmFsc2U7XG4gICAgICAgIHRoaXMudG9hc3RDb250YWluZXJJZCA9IGNvbmZpZ092ZXJyaWRlcy50b2FzdENvbnRhaW5lcklkICE9IG51bGwgPyBjb25maWdPdmVycmlkZXMudG9hc3RDb250YWluZXJJZCA6IG51bGw7XG4gICAgfVxuICAgIHJldHVybiBUb2FzdGVyQ29uZmlnO1xufSgpKTtcblxudmFyIF9fZGVjb3JhdGUkMSA9ICh1bmRlZmluZWQgJiYgdW5kZWZpbmVkLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xudmFyIF9fbWV0YWRhdGEkMSA9ICh1bmRlZmluZWQgJiYgdW5kZWZpbmVkLl9fbWV0YWRhdGEpIHx8IGZ1bmN0aW9uIChrLCB2KSB7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKGssIHYpO1xufTtcbi8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjY1MDE2ODgvYS10eXBlc2NyaXB0LWd1aWQtY2xhc3NcbnZhciBHdWlkID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEd1aWQoKSB7XG4gICAgfVxuICAgIEd1aWQubmV3R3VpZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHZhciByID0gTWF0aC5yYW5kb20oKSAqIDE2IHwgMCwgdiA9IGMgPT09ICd4JyA/IHIgOiAociAmIDB4MyB8IDB4OCk7XG4gICAgICAgICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIEd1aWQ7XG59KCkpO1xudmFyIFRvYXN0ZXJTZXJ2aWNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgVG9hc3RlclNlcnZpY2UuXG4gICAgICovXG4gICAgZnVuY3Rpb24gVG9hc3RlclNlcnZpY2UoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuYWRkVG9hc3QgPSBuZXcgcnhqcy5PYnNlcnZhYmxlKGZ1bmN0aW9uIChvYnNlcnZlcikgeyByZXR1cm4gX3RoaXMuX2FkZFRvYXN0ID0gb2JzZXJ2ZXI7IH0pLnBpcGUob3BlcmF0b3JzLnNoYXJlKCkpO1xuICAgICAgICB0aGlzLmNsZWFyVG9hc3RzID0gbmV3IHJ4anMuT2JzZXJ2YWJsZShmdW5jdGlvbiAob2JzZXJ2ZXIpIHsgcmV0dXJuIF90aGlzLl9jbGVhclRvYXN0cyA9IG9ic2VydmVyOyB9KS5waXBlKG9wZXJhdG9ycy5zaGFyZSgpKTtcbiAgICAgICAgdGhpcy5fcmVtb3ZlVG9hc3RTdWJqZWN0ID0gbmV3IHJ4anMuU3ViamVjdCgpO1xuICAgICAgICB0aGlzLnJlbW92ZVRvYXN0ID0gdGhpcy5fcmVtb3ZlVG9hc3RTdWJqZWN0LnBpcGUob3BlcmF0b3JzLnNoYXJlKCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTeW5jaHJvbm91c2x5IGNyZWF0ZSBhbmQgc2hvdyBhIG5ldyB0b2FzdCBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7KHN0cmluZyB8IFRvYXN0KX0gdHlwZSBUaGUgdHlwZSBvZiB0aGUgdG9hc3QsIG9yIGEgVG9hc3Qgb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nPX0gdGl0bGUgVGhlIHRvYXN0IHRpdGxlLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nPX0gYm9keSBUaGUgdG9hc3QgYm9keS5cbiAgICAgKiBAcmV0dXJucyB7VG9hc3R9XG4gICAgICogICAgICAgICAgVGhlIG5ld2x5IGNyZWF0ZWQgVG9hc3QgaW5zdGFuY2Ugd2l0aCBhIHJhbmRvbWx5IGdlbmVyYXRlZCBHVUlEIElkLlxuICAgICAqL1xuICAgIFRvYXN0ZXJTZXJ2aWNlLnByb3RvdHlwZS5wb3AgPSBmdW5jdGlvbiAodHlwZSwgdGl0bGUsIGJvZHkpIHtcbiAgICAgICAgdmFyIHRvYXN0ID0gdHlwZW9mIHR5cGUgPT09ICdzdHJpbmcnID8geyB0eXBlOiB0eXBlLCB0aXRsZTogdGl0bGUsIGJvZHk6IGJvZHkgfSA6IHR5cGU7XG4gICAgICAgIGlmICghdG9hc3QudG9hc3RJZCkge1xuICAgICAgICAgICAgdG9hc3QudG9hc3RJZCA9IEd1aWQubmV3R3VpZCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5fYWRkVG9hc3QpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gVG9hc3RlciBDb250YWluZXJzIGhhdmUgYmVlbiBpbml0aWFsaXplZCB0byByZWNlaXZlIHRvYXN0cy4nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9hZGRUb2FzdC5uZXh0KHRvYXN0KTtcbiAgICAgICAgcmV0dXJuIHRvYXN0O1xuICAgIH07XG4gICAgLyoqXG4gICAgICogQXN5bmNocm9ub3VzbHkgY3JlYXRlIGFuZCBzaG93IGEgbmV3IHRvYXN0IGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHsoc3RyaW5nIHwgVG9hc3QpfSB0eXBlIFRoZSB0eXBlIG9mIHRoZSB0b2FzdCwgb3IgYSBUb2FzdCBvYmplY3QuXG4gICAgICogQHBhcmFtIHtzdHJpbmc9fSB0aXRsZSBUaGUgdG9hc3QgdGl0bGUuXG4gICAgICogQHBhcmFtIHtzdHJpbmc9fSBib2R5IFRoZSB0b2FzdCBib2R5LlxuICAgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlPFRvYXN0Pn1cbiAgICAgKiAgICAgICAgICBBIGhvdCBPYnNlcnZhYmxlIHRoYXQgY2FuIGJlIHN1YnNjcmliZWQgdG8gaW4gb3JkZXIgdG8gcmVjZWl2ZSB0aGUgVG9hc3QgaW5zdGFuY2VcbiAgICAgKiAgICAgICAgICB3aXRoIGEgcmFuZG9tbHkgZ2VuZXJhdGVkIEdVSUQgSWQuXG4gICAgICovXG4gICAgVG9hc3RlclNlcnZpY2UucHJvdG90eXBlLnBvcEFzeW5jID0gZnVuY3Rpb24gKHR5cGUsIHRpdGxlLCBib2R5KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMucG9wKHR5cGUsIHRpdGxlLCBib2R5KTtcbiAgICAgICAgfSwgMCk7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZFRvYXN0O1xuICAgIH07XG4gICAgLyoqXG4gICAgICogQ2xlYXJzIGEgdG9hc3QgYnkgdG9hc3RJZCBhbmQvb3IgdG9hc3RDb250YWluZXJJZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0b2FzdElkIFRoZSB0b2FzdElkIHRvIGNsZWFyLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyPX0gdG9hc3RDb250YWluZXJJZFxuICAgICAqICAgICAgICBUaGUgdG9hc3RDb250YWluZXJJZCBvZiB0aGUgY29udGFpbmVyIHRvIHJlbW92ZSB0b2FzdHMgZnJvbS5cbiAgICAgKi9cbiAgICBUb2FzdGVyU2VydmljZS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAodG9hc3RJZCwgdG9hc3RDb250YWluZXJJZCkge1xuICAgICAgICB2YXIgY2xlYXJXcmFwcGVyID0ge1xuICAgICAgICAgICAgdG9hc3RJZDogdG9hc3RJZCwgdG9hc3RDb250YWluZXJJZDogdG9hc3RDb250YWluZXJJZFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9jbGVhclRvYXN0cy5uZXh0KGNsZWFyV3JhcHBlcik7XG4gICAgfTtcbiAgICBUb2FzdGVyU2VydmljZSA9IF9fZGVjb3JhdGUkMShbXG4gICAgICAgIGNvcmUuSW5qZWN0YWJsZSgpLFxuICAgICAgICBfX21ldGFkYXRhJDEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbXSlcbiAgICBdLCBUb2FzdGVyU2VydmljZSk7XG4gICAgcmV0dXJuIFRvYXN0ZXJTZXJ2aWNlO1xufSgpKTtcblxudmFyIF9fZGVjb3JhdGUkMiA9ICh1bmRlZmluZWQgJiYgdW5kZWZpbmVkLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xudmFyIF9fbWV0YWRhdGEkMiA9ICh1bmRlZmluZWQgJiYgdW5kZWZpbmVkLl9fbWV0YWRhdGEpIHx8IGZ1bmN0aW9uIChrLCB2KSB7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKGssIHYpO1xufTtcbnZhciBUb2FzdGVyQ29udGFpbmVyQ29tcG9uZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFRvYXN0ZXJDb250YWluZXJDb21wb25lbnQodG9hc3RlclNlcnZpY2UsIHJlZiwgbmdab25lKSB7XG4gICAgICAgIHRoaXMucmVmID0gcmVmO1xuICAgICAgICB0aGlzLm5nWm9uZSA9IG5nWm9uZTtcbiAgICAgICAgdGhpcy50aW1lb3V0SWRzID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLnRvYXN0cyA9IFtdO1xuICAgICAgICB0aGlzLnRvYXN0ZXJTZXJ2aWNlID0gdG9hc3RlclNlcnZpY2U7XG4gICAgfVxuICAgIFRvYXN0ZXJDb250YWluZXJDb21wb25lbnQucHJvdG90eXBlLm5nT25Jbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyU3Vic2NyaWJlcnMoKTtcbiAgICAgICAgaWYgKHRoaXMuaXNOdWxsT3JVbmRlZmluZWQodGhpcy50b2FzdGVyY29uZmlnKSkge1xuICAgICAgICAgICAgdGhpcy50b2FzdGVyY29uZmlnID0gbmV3IFRvYXN0ZXJDb25maWcoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLy8gZXZlbnQgaGFuZGxlcnNcbiAgICBUb2FzdGVyQ29udGFpbmVyQ29tcG9uZW50LnByb3RvdHlwZS5jbGljayA9IGZ1bmN0aW9uICh0b2FzdCwgaXNDbG9zZUJ1dHRvbikge1xuICAgICAgICBpZiAodGhpcy50b2FzdGVyY29uZmlnLnRhcFRvRGlzbWlzcyB8fCAodG9hc3Quc2hvd0Nsb3NlQnV0dG9uICYmIGlzQ2xvc2VCdXR0b24pKSB7XG4gICAgICAgICAgICB2YXIgcmVtb3ZlVG9hc3QgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKHRvYXN0LmNsaWNrSGFuZGxlcikge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdG9hc3QuY2xpY2tIYW5kbGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZVRvYXN0ID0gdG9hc3QuY2xpY2tIYW5kbGVyKHRvYXN0LCBpc0Nsb3NlQnV0dG9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUaGUgdG9hc3QgY2xpY2sgaGFuZGxlciBpcyBub3QgYSBjYWxsYWJsZSBmdW5jdGlvbi4nKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZW1vdmVUb2FzdCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlVG9hc3QodG9hc3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBUb2FzdGVyQ29udGFpbmVyQ29tcG9uZW50LnByb3RvdHlwZS5jaGlsZENsaWNrID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICB0aGlzLmNsaWNrKCRldmVudC52YWx1ZS50b2FzdCwgJGV2ZW50LnZhbHVlLmlzQ2xvc2VCdXR0b24pO1xuICAgIH07XG4gICAgVG9hc3RlckNvbnRhaW5lckNvbXBvbmVudC5wcm90b3R5cGUuc3RvcFRpbWVyID0gZnVuY3Rpb24gKHRvYXN0KSB7XG4gICAgICAgIGlmICh0aGlzLnRvYXN0ZXJjb25maWcubW91c2VvdmVyVGltZXJTdG9wKSB7XG4gICAgICAgICAgICB2YXIgdG9hc3RJZCA9IHRoaXMudG9hc3RJZE9yRGVmYXVsdCh0b2FzdCk7XG4gICAgICAgICAgICB2YXIgdGltZW91dElkID0gdGhpcy50aW1lb3V0SWRzLmdldCh0b2FzdElkKTtcbiAgICAgICAgICAgIGlmICh0aW1lb3V0SWQpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lb3V0SWRzLmRlbGV0ZSh0b2FzdElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgVG9hc3RlckNvbnRhaW5lckNvbXBvbmVudC5wcm90b3R5cGUucmVzdGFydFRpbWVyID0gZnVuY3Rpb24gKHRvYXN0KSB7XG4gICAgICAgIHZhciB0aW1lb3V0SWQgPSB0aGlzLnRpbWVvdXRJZHMuZ2V0KHRoaXMudG9hc3RJZE9yRGVmYXVsdCh0b2FzdCkpO1xuICAgICAgICBpZiAodGhpcy50b2FzdGVyY29uZmlnLm1vdXNlb3ZlclRpbWVyU3RvcCkge1xuICAgICAgICAgICAgaWYgKCF0aW1lb3V0SWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZ3VyZVRpbWVyKHRvYXN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0b2FzdC50aW1lb3V0ICE9PSAwICYmICF0aW1lb3V0SWQgJiYgdGhpcy50b2FzdGVyY29uZmlnLnRpbWVvdXQpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlVG9hc3QodG9hc3QpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvLyBwcml2YXRlIGZ1bmN0aW9uc1xuICAgIFRvYXN0ZXJDb250YWluZXJDb21wb25lbnQucHJvdG90eXBlLnJlZ2lzdGVyU3Vic2NyaWJlcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuYWRkVG9hc3RTdWJzY3JpYmVyID0gdGhpcy50b2FzdGVyU2VydmljZS5hZGRUb2FzdC5zdWJzY3JpYmUoZnVuY3Rpb24gKHRvYXN0KSB7XG4gICAgICAgICAgICBfdGhpcy5hZGRUb2FzdCh0b2FzdCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNsZWFyVG9hc3RzU3Vic2NyaWJlciA9IHRoaXMudG9hc3RlclNlcnZpY2UuY2xlYXJUb2FzdHMuc3Vic2NyaWJlKGZ1bmN0aW9uIChjbGVhcldyYXBwZXIpIHtcbiAgICAgICAgICAgIF90aGlzLmNsZWFyVG9hc3RzKGNsZWFyV3JhcHBlcik7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgVG9hc3RlckNvbnRhaW5lckNvbXBvbmVudC5wcm90b3R5cGUuYWRkVG9hc3QgPSBmdW5jdGlvbiAodG9hc3QpIHtcbiAgICAgICAgaWYgKHRvYXN0LnRvYXN0Q29udGFpbmVySWQgJiYgdGhpcy50b2FzdGVyY29uZmlnLnRvYXN0Q29udGFpbmVySWRcbiAgICAgICAgICAgICYmIHRvYXN0LnRvYXN0Q29udGFpbmVySWQgIT09IHRoaXMudG9hc3RlcmNvbmZpZy50b2FzdENvbnRhaW5lcklkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmICghdG9hc3QudHlwZSkge1xuICAgICAgICAgICAgdG9hc3QudHlwZSA9IHRoaXMudG9hc3RlcmNvbmZpZy5kZWZhdWx0VHlwZUNsYXNzO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnRvYXN0ZXJjb25maWcucHJldmVudER1cGxpY2F0ZXMgJiYgdGhpcy50b2FzdHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgaWYgKHRvYXN0LnRvYXN0SWQgJiYgdGhpcy50b2FzdHMuc29tZShmdW5jdGlvbiAodCkgeyByZXR1cm4gdC50b2FzdElkID09PSB0b2FzdC50b2FzdElkOyB9KSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMudG9hc3RzLnNvbWUoZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQuYm9keSA9PT0gdG9hc3QuYm9keTsgfSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXNOdWxsT3JVbmRlZmluZWQodG9hc3Quc2hvd0Nsb3NlQnV0dG9uKSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnRvYXN0ZXJjb25maWcuc2hvd0Nsb3NlQnV0dG9uID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHRvYXN0LnNob3dDbG9zZUJ1dHRvbiA9IHRoaXMudG9hc3RlcmNvbmZpZy5zaG93Q2xvc2VCdXR0b25bdG9hc3QudHlwZV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdGhpcy50b2FzdGVyY29uZmlnLnNob3dDbG9zZUJ1dHRvbiA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgdG9hc3Quc2hvd0Nsb3NlQnV0dG9uID0gdGhpcy50b2FzdGVyY29uZmlnLnNob3dDbG9zZUJ1dHRvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodG9hc3Quc2hvd0Nsb3NlQnV0dG9uKSB7XG4gICAgICAgICAgICB0b2FzdC5jbG9zZUh0bWwgPSB0b2FzdC5jbG9zZUh0bWwgfHwgdGhpcy50b2FzdGVyY29uZmlnLmNsb3NlSHRtbDtcbiAgICAgICAgfVxuICAgICAgICB0b2FzdC5ib2R5T3V0cHV0VHlwZSA9IHRvYXN0LmJvZHlPdXRwdXRUeXBlIHx8IHRoaXMudG9hc3RlcmNvbmZpZy5ib2R5T3V0cHV0VHlwZTtcbiAgICAgICAgdGhpcy5jb25maWd1cmVUaW1lcih0b2FzdCk7XG4gICAgICAgIGlmICh0aGlzLnRvYXN0ZXJjb25maWcubmV3ZXN0T25Ub3ApIHtcbiAgICAgICAgICAgIHRoaXMudG9hc3RzLnVuc2hpZnQodG9hc3QpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNMaW1pdEV4Y2VlZGVkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvYXN0cy5wb3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudG9hc3RzLnB1c2godG9hc3QpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNMaW1pdEV4Y2VlZGVkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvYXN0cy5zaGlmdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0b2FzdC5vblNob3dDYWxsYmFjaykge1xuICAgICAgICAgICAgdG9hc3Qub25TaG93Q2FsbGJhY2sodG9hc3QpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUb2FzdGVyQ29udGFpbmVyQ29tcG9uZW50LnByb3RvdHlwZS5jb25maWd1cmVUaW1lciA9IGZ1bmN0aW9uICh0b2FzdCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgdGltZW91dCA9ICh0eXBlb2YgdG9hc3QudGltZW91dCA9PT0gJ251bWJlcicpXG4gICAgICAgICAgICA/IHRvYXN0LnRpbWVvdXQgOiB0aGlzLnRvYXN0ZXJjb25maWcudGltZW91dDtcbiAgICAgICAgaWYgKHR5cGVvZiB0aW1lb3V0ID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgdGltZW91dCA9IHRpbWVvdXRbdG9hc3QudHlwZV07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmICh0aW1lb3V0ID4gMCkge1xuICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB0aW1lb3V0SWQgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLm5nWm9uZS5ydW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVmLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVtb3ZlVG9hc3QodG9hc3QpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCB0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICBfdGhpcy50aW1lb3V0SWRzLnNldChfdGhpcy50b2FzdElkT3JEZWZhdWx0KHRvYXN0KSwgdGltZW91dElkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUb2FzdGVyQ29udGFpbmVyQ29tcG9uZW50LnByb3RvdHlwZS5pc0xpbWl0RXhjZWVkZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRvYXN0ZXJjb25maWcubGltaXQgJiYgdGhpcy50b2FzdHMubGVuZ3RoID4gdGhpcy50b2FzdGVyY29uZmlnLmxpbWl0O1xuICAgIH07XG4gICAgVG9hc3RlckNvbnRhaW5lckNvbXBvbmVudC5wcm90b3R5cGUucmVtb3ZlVG9hc3QgPSBmdW5jdGlvbiAodG9hc3QpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy50b2FzdHMuaW5kZXhPZih0b2FzdCk7XG4gICAgICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdmFyIHRvYXN0SWQgPSB0aGlzLnRvYXN0SWRPckRlZmF1bHQodG9hc3QpO1xuICAgICAgICB2YXIgdGltZW91dElkID0gdGhpcy50aW1lb3V0SWRzLmdldCh0b2FzdElkKTtcbiAgICAgICAgdGhpcy50b2FzdHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgaWYgKHRpbWVvdXRJZCkge1xuICAgICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0SWRzLmRlbGV0ZSh0b2FzdElkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodG9hc3Qub25IaWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICAgIHRvYXN0Lm9uSGlkZUNhbGxiYWNrKHRvYXN0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRvYXN0ZXJTZXJ2aWNlLl9yZW1vdmVUb2FzdFN1YmplY3QubmV4dCh7IHRvYXN0SWQ6IHRvYXN0SWQsIHRvYXN0Q29udGFpbmVySWQ6IHRvYXN0LnRvYXN0Q29udGFpbmVySWQgfSk7XG4gICAgfTtcbiAgICBUb2FzdGVyQ29udGFpbmVyQ29tcG9uZW50LnByb3RvdHlwZS5yZW1vdmVBbGxUb2FzdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRvYXN0cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVUb2FzdCh0aGlzLnRvYXN0c1tpXSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRvYXN0ZXJDb250YWluZXJDb21wb25lbnQucHJvdG90eXBlLmNsZWFyVG9hc3RzID0gZnVuY3Rpb24gKGNsZWFyV3JhcHBlcikge1xuICAgICAgICB2YXIgdG9hc3RJZCA9IGNsZWFyV3JhcHBlci50b2FzdElkO1xuICAgICAgICB2YXIgdG9hc3RDb250YWluZXJJZCA9IGNsZWFyV3JhcHBlci50b2FzdENvbnRhaW5lcklkO1xuICAgICAgICBpZiAodGhpcy5pc051bGxPclVuZGVmaW5lZCh0b2FzdENvbnRhaW5lcklkKSkge1xuICAgICAgICAgICAgdGhpcy5jbGVhclRvYXN0c0FjdGlvbih0b2FzdElkKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0b2FzdENvbnRhaW5lcklkID09PSB0aGlzLnRvYXN0ZXJjb25maWcudG9hc3RDb250YWluZXJJZCkge1xuICAgICAgICAgICAgdGhpcy5jbGVhclRvYXN0c0FjdGlvbih0b2FzdElkKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVG9hc3RlckNvbnRhaW5lckNvbXBvbmVudC5wcm90b3R5cGUuY2xlYXJUb2FzdHNBY3Rpb24gPSBmdW5jdGlvbiAodG9hc3RJZCkge1xuICAgICAgICBpZiAodG9hc3RJZCkge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVUb2FzdCh0aGlzLnRvYXN0cy5maWx0ZXIoZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQudG9hc3RJZCA9PT0gdG9hc3RJZDsgfSlbMF0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVBbGxUb2FzdHMoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVG9hc3RlckNvbnRhaW5lckNvbXBvbmVudC5wcm90b3R5cGUudG9hc3RJZE9yRGVmYXVsdCA9IGZ1bmN0aW9uICh0b2FzdCkge1xuICAgICAgICByZXR1cm4gdG9hc3QudG9hc3RJZCB8fCAnJztcbiAgICB9O1xuICAgIFRvYXN0ZXJDb250YWluZXJDb21wb25lbnQucHJvdG90eXBlLmlzTnVsbE9yVW5kZWZpbmVkID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnO1xuICAgIH07XG4gICAgVG9hc3RlckNvbnRhaW5lckNvbXBvbmVudC5wcm90b3R5cGUubmdPbkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmFkZFRvYXN0U3Vic2NyaWJlcikge1xuICAgICAgICAgICAgdGhpcy5hZGRUb2FzdFN1YnNjcmliZXIudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jbGVhclRvYXN0c1N1YnNjcmliZXIpIHtcbiAgICAgICAgICAgIHRoaXMuY2xlYXJUb2FzdHNTdWJzY3JpYmVyLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIF9fZGVjb3JhdGUkMihbXG4gICAgICAgIGNvcmUuSW5wdXQoKSxcbiAgICAgICAgX19tZXRhZGF0YSQyKFwiZGVzaWduOnR5cGVcIiwgVG9hc3RlckNvbmZpZylcbiAgICBdLCBUb2FzdGVyQ29udGFpbmVyQ29tcG9uZW50LnByb3RvdHlwZSwgXCJ0b2FzdGVyY29uZmlnXCIsIHZvaWQgMCk7XG4gICAgVG9hc3RlckNvbnRhaW5lckNvbXBvbmVudCA9IF9fZGVjb3JhdGUkMihbXG4gICAgICAgIGNvcmUuQ29tcG9uZW50KHtcbiAgICAgICAgICAgIHNlbGVjdG9yOiAndG9hc3Rlci1jb250YWluZXInLFxuICAgICAgICAgICAgdGVtcGxhdGU6IFwiXFxuICAgICAgICA8ZGl2IGlkPVxcXCJ0b2FzdC1jb250YWluZXJcXFwiIFtuZ0NsYXNzXT1cXFwiW3RvYXN0ZXJjb25maWcucG9zaXRpb25DbGFzc11cXFwiPlxcbiAgICAgICAgICAgIDxkaXYgdG9hc3RDb21wICpuZ0Zvcj1cXFwibGV0IHRvYXN0IG9mIHRvYXN0c1xcXCIgY2xhc3M9XFxcInRvYXN0XFxcIiBbdG9hc3RdPVxcXCJ0b2FzdFxcXCJcXG4gICAgICAgICAgICAgICAgW0B0b2FzdFN0YXRlXT1cXFwidG9hc3RlcmNvbmZpZy5hbmltYXRpb25cXFwiXFxuICAgICAgICAgICAgICAgIFtpY29uQ2xhc3NdPVxcXCJ0b2FzdGVyY29uZmlnLmljb25DbGFzc2VzW3RvYXN0LnR5cGVdXFxcIlxcbiAgICAgICAgICAgICAgICBbdGl0bGVDbGFzc109XFxcInRvYXN0ZXJjb25maWcudGl0bGVDbGFzc1xcXCJcXG4gICAgICAgICAgICAgICAgW21lc3NhZ2VDbGFzc109XFxcInRvYXN0ZXJjb25maWcubWVzc2FnZUNsYXNzXFxcIlxcbiAgICAgICAgICAgICAgICBbbmdDbGFzc109XFxcInRvYXN0ZXJjb25maWcudHlwZUNsYXNzZXNbdG9hc3QudHlwZV1cXFwiXFxuICAgICAgICAgICAgICAgIChjbGljayk9XFxcImNsaWNrKHRvYXN0KVxcXCIgKGNsaWNrRXZlbnQpPVxcXCJjaGlsZENsaWNrKCRldmVudClcXFwiXFxuICAgICAgICAgICAgICAgIChtb3VzZW92ZXIpPVxcXCJzdG9wVGltZXIodG9hc3QpXFxcIiAobW91c2VvdXQpPVxcXCJyZXN0YXJ0VGltZXIodG9hc3QpXFxcIj5cXG4gICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgIDwvZGl2PlxcbiAgICAgICAgXCIsXG4gICAgICAgICAgICBhbmltYXRpb25zOiBbXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9ucy50cmlnZ2VyKCd0b2FzdFN0YXRlJywgW1xuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25zLnN0YXRlKCdmbHlSaWdodCwgZmx5TGVmdCwgc2xpZGVEb3duLCBzbGlkZVVwLCBmYWRlJywgYW5pbWF0aW9ucy5zdHlsZSh7IG9wYWNpdHk6IDEsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgwLDApJyB9KSksXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbnMudHJhbnNpdGlvbigndm9pZCA9PiBmbHlSaWdodCcsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbnMuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoMTAwJSknXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbnMuYW5pbWF0ZSgnMC4yNXMgZWFzZS1pbicpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25zLnRyYW5zaXRpb24oJ2ZseVJpZ2h0ID0+IHZvaWQnLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25zLmFuaW1hdGUoJzAuMjVzIDEwbXMgZWFzZS1vdXQnLCBhbmltYXRpb25zLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKDEwMCUpJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25zLnRyYW5zaXRpb24oJ3ZvaWQgPT4gZmx5TGVmdCcsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbnMuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoLTEwMCUpJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25zLmFuaW1hdGUoJzAuMjVzIGVhc2UtaW4nKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9ucy50cmFuc2l0aW9uKCdmbHlMZWZ0ID0+IHZvaWQnLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25zLmFuaW1hdGUoJzAuMjVzIDEwbXMgZWFzZS1vdXQnLCBhbmltYXRpb25zLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKC0xMDAlKSdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9ucy50cmFuc2l0aW9uKCd2b2lkID0+IHNsaWRlRG93bicsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbnMuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoLTIwMCUpJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25zLmFuaW1hdGUoJzAuM3MgZWFzZS1pbicpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25zLnRyYW5zaXRpb24oJ3NsaWRlRG93biA9PiB2b2lkJywgW1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9ucy5hbmltYXRlKCcwLjNzIDEwbXMgZWFzZS1vdXQnLCBhbmltYXRpb25zLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKDIwMCUpJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25zLnRyYW5zaXRpb24oJ3ZvaWQgPT4gc2xpZGVVcCcsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbnMuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoMjAwJSknXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbnMuYW5pbWF0ZSgnMC4zcyBlYXNlLWluJylcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbnMudHJhbnNpdGlvbignc2xpZGVVcCA9PiB2b2lkJywgW1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9ucy5hbmltYXRlKCcwLjNzIDEwbXMgZWFzZS1vdXQnLCBhbmltYXRpb25zLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKC0yMDAlKSdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9ucy50cmFuc2l0aW9uKCd2b2lkID0+IGZhZGUnLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25zLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25zLmFuaW1hdGUoJzAuM3MgZWFzZS1pbicpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25zLnRyYW5zaXRpb24oJ2ZhZGUgPT4gdm9pZCcsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbnMuYW5pbWF0ZSgnMC4zcyAxMG1zIGVhc2Utb3V0JywgYW5pbWF0aW9ucy5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgXVxuICAgICAgICB9KSxcbiAgICAgICAgX19tZXRhZGF0YSQyKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW1RvYXN0ZXJTZXJ2aWNlLCBjb3JlLkNoYW5nZURldGVjdG9yUmVmLCBjb3JlLk5nWm9uZV0pXG4gICAgXSwgVG9hc3RlckNvbnRhaW5lckNvbXBvbmVudCk7XG4gICAgcmV0dXJuIFRvYXN0ZXJDb250YWluZXJDb21wb25lbnQ7XG59KCkpO1xuXG52YXIgX19kZWNvcmF0ZSQzID0gKHVuZGVmaW5lZCAmJiB1bmRlZmluZWQuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcbn07XG52YXIgVG9hc3Rlck1vZHVsZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUb2FzdGVyTW9kdWxlKCkge1xuICAgIH1cbiAgICBUb2FzdGVyTW9kdWxlXzEgPSBUb2FzdGVyTW9kdWxlO1xuICAgIFRvYXN0ZXJNb2R1bGUuZm9yUm9vdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5nTW9kdWxlOiBUb2FzdGVyTW9kdWxlXzEsXG4gICAgICAgICAgICBwcm92aWRlcnM6IFtUb2FzdGVyU2VydmljZSwgVG9hc3RlckNvbnRhaW5lckNvbXBvbmVudF1cbiAgICAgICAgfTtcbiAgICB9O1xuICAgIFRvYXN0ZXJNb2R1bGUuZm9yQ2hpbGQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuZ01vZHVsZTogVG9hc3Rlck1vZHVsZV8xLFxuICAgICAgICAgICAgcHJvdmlkZXJzOiBbVG9hc3RlckNvbnRhaW5lckNvbXBvbmVudF1cbiAgICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBUb2FzdGVyTW9kdWxlXzE7XG4gICAgVG9hc3Rlck1vZHVsZSA9IFRvYXN0ZXJNb2R1bGVfMSA9IF9fZGVjb3JhdGUkMyhbXG4gICAgICAgIGNvcmUuTmdNb2R1bGUoe1xuICAgICAgICAgICAgaW1wb3J0czogW2NvbW1vbi5Db21tb25Nb2R1bGVdLFxuICAgICAgICAgICAgZGVjbGFyYXRpb25zOiBbXG4gICAgICAgICAgICAgICAgVG9hc3RDb21wb25lbnQsXG4gICAgICAgICAgICAgICAgVG9hc3RlckNvbnRhaW5lckNvbXBvbmVudFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGV4cG9ydHM6IFtcbiAgICAgICAgICAgICAgICBUb2FzdGVyQ29udGFpbmVyQ29tcG9uZW50LFxuICAgICAgICAgICAgICAgIFRvYXN0Q29tcG9uZW50XG4gICAgICAgICAgICBdXG4gICAgICAgIH0pXG4gICAgXSwgVG9hc3Rlck1vZHVsZSk7XG4gICAgcmV0dXJuIFRvYXN0ZXJNb2R1bGU7XG59KCkpO1xuXG5leHBvcnRzLlRvYXN0Q29tcG9uZW50ID0gVG9hc3RDb21wb25lbnQ7XG5leHBvcnRzLlRvYXN0ZXJDb250YWluZXJDb21wb25lbnQgPSBUb2FzdGVyQ29udGFpbmVyQ29tcG9uZW50O1xuZXhwb3J0cy5Ub2FzdGVyU2VydmljZSA9IFRvYXN0ZXJTZXJ2aWNlO1xuZXhwb3J0cy5Ub2FzdGVyQ29uZmlnID0gVG9hc3RlckNvbmZpZztcbmV4cG9ydHMuVG9hc3Rlck1vZHVsZSA9IFRvYXN0ZXJNb2R1bGU7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG5cbn0pKSk7XG4iXX0=