{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{tLRc:function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.r(__webpack_exports__);var common=__webpack_require__(\"ofXK\"),router=__webpack_require__(\"tyNb\"),tslib_es6=__webpack_require__(\"mrSG\"),moment=__webpack_require__(\"wd/R\"),core=__webpack_require__(\"fXoL\"),api_service=__webpack_require__(\"H+bZ\"),util_service=__webpack_require__(\"2Rin\"),cart_service=__webpack_require__(\"c14U\");const routes=[{path:\"\",component:(()=>{class InstamojocallbackComponent{constructor(route,api,util,cart,router){this.route=route,this.api=api,this.util=util,this.cart=cart,this.router=router,this.route.queryParams.subscribe(data=>{console.log(\"=======================>\",data),this.status=data.status,data&&data.payment_status&&data.payment_id?(x=>{try{return JSON.parse(x),!0}catch(e){return!1}})(localStorage.getItem(\"cartItems\"))?(this.cart.cart=JSON.parse(localStorage.getItem(\"cartItems\")),this.cart.deliveryAt=localStorage.getItem(\"deliveryAt\"),this.cart.datetime=localStorage.getItem(\"datetime\"),this.cart.totalPrice=localStorage.getItem(\"totalPrice\"),this.cart.orderTax=localStorage.getItem(\"orderTax\"),this.cart.grandTotal=localStorage.getItem(\"grandTotal\"),this.cart.deliveryPrice=localStorage.getItem(\"deliveryPrice\"),this.cart.coupon=(x=>{try{return JSON.parse(x),!0}catch(e){return!1}})(localStorage.getItem(\"appliedCoupon\"))?JSON.parse(localStorage.getItem(\"appliedCoupon\")):null,this.cart.userOrderTaxByStores=(x=>{try{return JSON.parse(x),!0}catch(e){return!1}})(localStorage.getItem(\"userOrderTaxByStores\"))?JSON.parse(localStorage.getItem(\"userOrderTaxByStores\")):[],this.cart.deliveryAddress=(x=>{try{return JSON.parse(x),!0}catch(e){return!1}})(localStorage.getItem(\"selectedAddress\"))?JSON.parse(localStorage.getItem(\"selectedAddress\")):null,this.cart.discount=localStorage.getItem(\"discount\"),console.log(\"cart instance calcuatelllll,,,,,\",this.cart),this.createOrder(\"instamojo\",data.payment_id)):(console.log(\"somerthing went wrong\"),localStorage.removeItem(\"cartItems\"),localStorage.removeItem(\"deliveryAt\"),localStorage.removeItem(\"datetime\"),localStorage.removeItem(\"totalPrice\"),localStorage.removeItem(\"orderTax\"),localStorage.removeItem(\"grandTotal\"),localStorage.removeItem(\"deliveryPrice\"),localStorage.removeItem(\"appliedCoupon\"),localStorage.removeItem(\"userOrderTaxByStores\"),localStorage.removeItem(\"discount\"),localStorage.removeItem(\"selectedAddress\"),this.util.errorMessage(this.util.translate(\"Something went wrong\"))):(localStorage.removeItem(\"cartItems\"),localStorage.removeItem(\"deliveryAt\"),localStorage.removeItem(\"datetime\"),localStorage.removeItem(\"totalPrice\"),localStorage.removeItem(\"orderTax\"),localStorage.removeItem(\"grandTotal\"),localStorage.removeItem(\"deliveryPrice\"),localStorage.removeItem(\"appliedCoupon\"),localStorage.removeItem(\"userOrderTaxByStores\"),localStorage.removeItem(\"discount\"),localStorage.removeItem(\"selectedAddress\"),this.util.errorMessage(this.util.translate(\"Something went wrong\")),this.router.navigate([\"\"]))})}createOrder(payMethod,payKey){return Object(tslib_es6.a)(this,void 0,void 0,(function*(){const storeId=[...new Set(this.cart.cart.map(item=>item.store_id))],orderStatus=[];storeId.forEach(element=>{orderStatus.push({id:element,status:\"created\"})});const notes=[{status:1,value:\"Order Created\",time:moment().format(\"lll\")}];this.cart.deliveryAt=this.cart.deliveryAt?this.cart.deliveryAt:\"\";const param={uid:localStorage.getItem(\"uid\"),store_id:storeId.join(),date_time:\"today\"===this.cart.datetime?moment().format(\"YYYY-MM-DD HH:mm:ss\"):moment().add(1,\"days\").format(\"YYYY-MM-DD HH:mm:ss\"),paid_method:payMethod,order_to:this.cart.deliveryAt,orders:JSON.stringify(this.cart.cart),notes:JSON.stringify(notes),address:\"home\"===this.cart.deliveryAt?JSON.stringify(this.cart.deliveryAddress):\"\",driver_id:\"\",total:this.cart.totalPrice,tax:this.cart.orderTax,grand_total:this.cart.grandTotal,delivery_charge:this.cart.deliveryPrice,coupon_code:this.cart.coupon?JSON.stringify(this.cart.coupon):\"\",discount:this.cart.discount,pay_key:payKey,status:JSON.stringify(orderStatus),assignee:\"\",extra:JSON.stringify(this.cart.userOrderTaxByStores)};console.log(\"param-----\\x3e\",param),this.util.start(),this.api.post(\"orders/save\",param).then(data=>{console.log(data),this.util.stop(),localStorage.removeItem(\"cartItems\"),localStorage.removeItem(\"deliveryAt\"),localStorage.removeItem(\"datetime\"),localStorage.removeItem(\"totalPrice\"),localStorage.removeItem(\"orderTax\"),localStorage.removeItem(\"grandTotal\"),localStorage.removeItem(\"deliveryPrice\"),localStorage.removeItem(\"appliedCoupon\"),localStorage.removeItem(\"userOrderTaxByStores\"),localStorage.removeItem(\"discount\"),localStorage.removeItem(\"selectedAddress\"),this.util.errorMessage(this.util.translate(\"Something went wrong\")),this.api.createOrderNotification(this.cart.stores),this.cart.clearCart(),this.util.publishNewOrder();const name=(this.util.userInfo.first_name+\"-\"+this.util.userInfo.last_name).toLowerCase();this.router.navigate([\"user\",name,\"order\"])},error=>{console.log(error),this.util.stop(),localStorage.removeItem(\"cartItems\"),localStorage.removeItem(\"deliveryAt\"),localStorage.removeItem(\"datetime\"),localStorage.removeItem(\"totalPrice\"),localStorage.removeItem(\"orderTax\"),localStorage.removeItem(\"grandTotal\"),localStorage.removeItem(\"deliveryPrice\"),localStorage.removeItem(\"appliedCoupon\"),localStorage.removeItem(\"userOrderTaxByStores\"),localStorage.removeItem(\"discount\"),localStorage.removeItem(\"selectedAddress\"),this.util.errorMessage(this.util.translate(\"Something went wrong\")),this.util.errorMessage(this.util.translate(\"Something went wrong\"))}).catch(error=>{console.log(error),this.util.stop(),localStorage.removeItem(\"cartItems\"),localStorage.removeItem(\"deliveryAt\"),localStorage.removeItem(\"datetime\"),localStorage.removeItem(\"totalPrice\"),localStorage.removeItem(\"orderTax\"),localStorage.removeItem(\"grandTotal\"),localStorage.removeItem(\"deliveryPrice\"),localStorage.removeItem(\"appliedCoupon\"),localStorage.removeItem(\"userOrderTaxByStores\"),localStorage.removeItem(\"discount\"),localStorage.removeItem(\"selectedAddress\"),this.util.errorMessage(this.util.translate(\"Something went wrong\")),this.util.errorMessage(this.util.translate(\"Something went wrong\"))})}))}ngOnInit(){}}return InstamojocallbackComponent.ɵfac=function(t){return new(t||InstamojocallbackComponent)(core[\"ɵɵdirectiveInject\"](router.a),core[\"ɵɵdirectiveInject\"](api_service.a),core[\"ɵɵdirectiveInject\"](util_service.a),core[\"ɵɵdirectiveInject\"](cart_service.a),core[\"ɵɵdirectiveInject\"](router.f))},InstamojocallbackComponent.ɵcmp=core[\"ɵɵdefineComponent\"]({type:InstamojocallbackComponent,selectors:[[\"app-instamojocallback\"]],decls:2,vars:1,consts:[[2,\"text-align\",\"center\"]],template:function(rf,ctx){1&rf&&(core[\"ɵɵelementStart\"](0,\"h2\",0),core[\"ɵɵtext\"](1),core[\"ɵɵelementEnd\"]()),2&rf&&(core[\"ɵɵadvance\"](1),core[\"ɵɵtextInterpolate1\"](\" \",ctx.util.translate(\"Please wait, we are processing your order\"),\" \"))},styles:[\"\"]}),InstamojocallbackComponent})()}];let instamojocallback_routing_module_InstamojocallbackRoutingModule=(()=>{class InstamojocallbackRoutingModule{}return InstamojocallbackRoutingModule.ɵmod=core[\"ɵɵdefineNgModule\"]({type:InstamojocallbackRoutingModule}),InstamojocallbackRoutingModule.ɵinj=core[\"ɵɵdefineInjector\"]({factory:function(t){return new(t||InstamojocallbackRoutingModule)},imports:[[router.h.forChild(routes)],router.h]}),InstamojocallbackRoutingModule})();__webpack_require__.d(__webpack_exports__,\"InstamojocallbackModule\",(function(){return instamojocallback_module_InstamojocallbackModule}));let instamojocallback_module_InstamojocallbackModule=(()=>{class InstamojocallbackModule{}return InstamojocallbackModule.ɵmod=core[\"ɵɵdefineNgModule\"]({type:InstamojocallbackModule}),InstamojocallbackModule.ɵinj=core[\"ɵɵdefineInjector\"]({factory:function(t){return new(t||InstamojocallbackModule)},imports:[[common.CommonModule,instamojocallback_routing_module_InstamojocallbackRoutingModule]]}),InstamojocallbackModule})()}}]);","extractedComments":[]}